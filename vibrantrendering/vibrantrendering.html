<!doctype>
<html>
	<head>
		<script>
			var gl = null;
			var canvas = null;
			var CORE = {};

			CORE.init = function(){
				canvas = document.createElement("canvas");
				canvas.style.width = "100%";
				canvas.style.height = "100%";
				document.body.appendChild( canvas );
				
				gl = canvas.getContext("webgl");
				if(!gl){ alert("No WebGL support"); return; }
				
				CORE.scene = new CORE.Obj("scene");
				
				CORE.update();
			};
			
			CORE.update = function(){
				requestAnimationFrame( CORE.update );
				CORE.render();
			};
			
			CORE.render = function(){
				
			};
			
			CORE.Material = class Material{
				constructor(){
					this.program = null;
					this.uniforms = {};
				}
			};
			
			CORE.Texture = class Texture{
				constructor(){
					
				}
			};
			
			CORE.Mesh = class Mesh{
				constructor(){
					this.attributes = [];
					this.vertexCount = 0;
				}
				SetAttribute(name, data, size, type, normalized){
					var attr = null;
					for(var i = 0; i < this.attributes.length; i++){
						if(this.attributes[i].name == name){
							attr = this.attributes[i];
							break;
						}
					}
					if(attr == null){
						attr = {
							index : this.attributes.length,
							name : name,
							data : data,
							type : type,
							normalized : normalized,
							buffer : gl.createBuffer()
						};
						this.attributes.push(attr);
					}
					attr.data = data;
					attr.size = size;
					attr.type = type;
					attr.normalized = normalized;
					
					gl.bindBuffer(gl.ARRAY_BUFFER, attr.buffer);
					gl.bufferData(gl.ARRAY_BUFFER, attr.data, gl.STATIC_DRAW);
					gl.enableVertexAttribArray(attr.index);
				}
				SetVertices( data ){
					this.SetAttribute( "vertex", data, 3, gl.FLOAT, false );
					this.vertexCount = data.length / 3;
				}
				Draw(){
					for(var i = 0; i < data.attributes.length; i++){
						var attr = data.attributes[i];
						gl.vertexAttribPointer( attr.index, attr.size, attr.type, attr.normalized, 0, 0 );
					}
				}
			};
			
			CORE.Obj = class Obj{
				constructor(name){
					this.name = name;
					this.position = new Float32Array([0,0,0]);
					this.rotation = new Float32Array([0,0,0,1]);
					this.scale = new Float32Array([1,1,1]);
					this.localToWorld = new Float32Array([ 1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1 ]);
					this.parent = null;
					this.children = [];
					this.mesh = null;
					this.material = null;
				}
			};
			
			CORE.Camera = class Camera extends CORE.Obj{
				constructor(){
					super();
				}
			}
				
			CORE.MeshObj = class MeshObj extends CORE.Obj{
				constructor(){
					super();
				}
			};
		</script>
	</head>
	<body>
		<script>
			CORE.init();
			var plane = new CORE.Mesh();
			plane.SetAttribute(
				"vertex", 
				new Float32Array([ -1,-1,0, 1,-1,0, 1,1,0, -1,-1,0, -1,1,0, 1,1,0 ]),
				3,
				false
			);
			console.log(plane);
		</script>
	</body>
</html>
